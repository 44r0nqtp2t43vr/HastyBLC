@model BookSearchViewModel
@section styles {
    <link rel="stylesheet" href="~/css/HastyBLC.css" />
}

@{
    ViewData["Title"] = "Browse Books";
}

<html>
<body>
    <div class="sidebar">
        <div class="image">
            <img src="~/img/logo.png" class="imagehw">
        </div>
        <div class="hasty">
            <h1>HASTY</h1>
            <h1>BLC</h1>
        </div>
        <div class="screens">
            <a asp-controller="Dashboard" asp-action="Dashboard">Dashboard</a>
            <a asp-controller="Books" asp-action="Books" class="active">Browse Books</a>
        </div>
    </div>

    <div class="content">
        <form method="post" action="/Books/SearchBooks">
            <!-- Search Bar -->
            <div class="search-bar">

                <input asp-for="SearchText" type="text" name="SearchText" placeholder="Search by title or author...">
                    <button type="submit">Search</button>
            
            </div>

            <!-- Filter by Book Genres -->
            <div class="filter-section">
                <h3>
                    <span>Filter by</span>
                    <button type="button" id="expandCollapseGenres" class="btn btn-link float-right">Collapse</button>
                </h3>
                <h4>Book Genres</h4>

                <!-- Checkbox for each genre -->
                <div class="checkbox-container">
                    @for (var i = 0; i < Model.Genres!.Count; i++)
                    {
                        <div>
                            <input type="checkbox" name="IsGenreSelected[@i]" id="genre@(i)" class="genre-filter" value="IsGenreSelected[@i]" />
                            <label asp-for="IsGenreSelected">@Model.Genres[i].Name</label>
                        </div>
                    }
                </div>


                <!-- Clear all filters button -->
                <button type="button" id="clearFilters" class="btn btn-link float-right">Clear all filters</button>

                <!-- Search and Clear Buttons Container -->
                @* <div class="clearfix"></div> *@
                @* <div class="buttons-container">
                    <!-- Clear all filters button -->
                    <button id="searchButton" class="btn btn-primary mx-auto d-block">Search</button>
                </div> *@
            </div>
        </form>
        <h2 class="title">ALL BOOKS</h2>
        <div class="books-row">
            @foreach (var book in Model.Books!)
            {
                <div class="book-item">
                    <div class="book-image-container">
                        <a asp-controller="Books" asp-action="ViewBook" asp-route-id="@book.BookId">
                            <img src="~/@Html.Raw(book.Image)" alt="@book.Title" class="book-image" />
                        </a>

                    </div>
                </div>
            }
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var button = document.getElementById('expandCollapseGenres');
            var genreCheckboxes = document.querySelectorAll('.genre-filter');

            // Set the button text to 'Expand'
            button.textContent = 'Expand';

            // Hide genre checkboxes
            genreCheckboxes.forEach(function (checkbox) {
                checkbox.parentElement.style.display = 'none';
            });
        });

        // Toggle expand/collapse functionality
        document.getElementById('expandCollapseGenres').addEventListener('click', function () {
            var button = this;
            var text = button.textContent.trim();

            if (text === 'Expand') {
                button.textContent = 'Collapse';
                var genreCheckboxes = document.querySelectorAll('.genre-filter');
                genreCheckboxes.forEach(function (checkbox) {
                    checkbox.parentElement.style.display = 'block';
                });
            } else {
                button.textContent = 'Expand';
                var genreCheckboxes = document.querySelectorAll('.genre-filter');
                genreCheckboxes.forEach(function (checkbox) {
                    checkbox.parentElement.style.display = 'none';
                });
            }
        });


        // Clear all filters functionality  
        document.getElementById('clearFilters').addEventListener('click', function () {
            var genreFilters = document.querySelectorAll('.genre-filter:checked');

            genreFilters.forEach(function (filter) {
                filter.checked = false;
            });
        });

        // Search functionality
        // document.getElementById('searchButton').addEventListener('click', function () {
        //     var searchTerm = document.getElementById('search').value.toLowerCase();
        //     var bookItems = document.querySelectorAll('.book-item');
        // 
        //     bookItems.forEach(function (item) {
        //         var title = item.querySelector('.book-title').textContent.toLowerCase();
        //         item.style.display = title.includes(searchTerm) ? 'block' : 'none';
        //     });
        // });

        // Filter functionality
        var genreFilters = document.querySelectorAll('.genre-filter');

        genreFilters.forEach(function (filter) {
            filter.addEventListener('change', function () {
                var selectedGenres = Array.from(document.querySelectorAll('.genre-filter:checked')).map(function (checkbox) {
                    return parseInt(checkbox.value);
                });

                var bookItems = document.querySelectorAll('.book-item');

                bookItems.forEach(function (item) {
                    var genres = item.dataset.genres.split(',').map(function (id) {
                        return parseInt(id.trim());
                    });

                    var isVisible = selectedGenres.some(function (genre) {
                        return genres.includes(genre);
                    });

                    item.style.display = isVisible ? 'block' : 'none';
                });
            });
        });
    </script>

</body>
</html>
